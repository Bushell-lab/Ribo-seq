#!/usr/bin/env bash

#read in variables
source common_variables.sh

#set lengths and offsets. These are the final ones which you will use for any codon level analysis.
#Use the plots generated by the periodicity and offset scripts to decide what values to set these at

lengths='28,29,30'
offsets='12,12,12'

#run counting script to generate <.counts> files
#use the best alignments so that all transcripts can be used, without any reads counting twice
for filename in $RPF_filenames
do
counting_script.py -bam $BAM_dir/${filename}_pc_sorted.bam -fasta $most_abundant_fasta -len $lengths -offset $offsets -out_file ${filename}_pc_final_codon.counts -out_dir $counts_dir &
done
wait

#run count_codon_occupancy.py to calculate codon occupancy counts in each position of the ribosome
for filename in $RPF_filenames
do
count_codon_occupancy.py ${filename}_pc_final_codon.counts $most_abundant_fasta $region_lengths -in_dir $counts_dir -out_dir $codon_counts_dir &
done
wait
